ext {
    dockerImageName = "colsson210/$name"
    dockerTag = version
}

task wrapper(type: Wrapper) {
    gradleVersion = '2.4'
}

task dockerRunTest(type: Exec) {
    group 'Docker'
    description "Run the tetris unit tests"
    commandLine 'docker'
    args = ['run', '--rm', '--name', 'tetris', "$dockerImageName", 'npm', 'test']
}

task dockerEndToEndRunTest(type: Exec) {
    group 'Docker'
    description "Run the tetris end to end test"
    commandLine 'docker'
    args = ['run', '--rm', '--name', 'tetris', "$dockerImageName", 'npm', 'run', 'endToEndTest']
}

task dockerStop(type: Exec) {
    group 'Docker'
    description 'Stop the jenkins docker container'
    commandLine 'docker'
    args = ['rm', '-f', '-v', 'tetris']
}

task dockerStatus(type: Exec) {
    group 'Docker'
    description 'Display the process status of jenkins docker container'
    commandLine 'docker'
    args = ['ps', '-a', '-f', "name=tetris"]
}

task dockerBuild(type: Exec) {
    group 'Docker'
    description "Build the docker image, tag as current version and 'as latest'."
    commandLine 'docker'
    args = ['build', '-t', "$dockerImageName:$dockerTag", '-t', "$dockerImageName:latest", "."]
}

task dockerPush(type: Exec) {
    group 'Docker'
    description 'Push the docker image with the current tag'
    commandLine 'docker'
    args = ['push', "$dockerImageName:$dockerTag"]
}
